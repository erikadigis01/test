<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->
<html xmlns:th="http://www.thymeleaf.org"
      xmls:layout="https://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{Layout}">
    <body class="container bg-light" layout:fragment="content">
        <header></header> 
        <main class="my-3 p-3 d-flex justify-content-center">
            <div class="card" style="width: 48rem">
                <form class="p-4 justify-content-center my-3" th:action="@{add}" th:object="${Usuario}" method="post" enctype="multipart/form-data">
                    <div class="h4 d-flex justify-content-center"> Agregar usuario</div>
                    <div class="h6 text-black-50"> Datos Personales</div>
                    <div class="row my-1">
                        <div class="col-4">
                            <div class="mb-3">
                                <label for="userName" class="form-label">UserName</label>
                                <input type="text" class="form-control" id="userName" th:field="*{UserName}" ><!-- onblur="isUserName(event, this)" -->
                                <span th:if="${#fields.hasErrors('UserName')}" th:errors="*{UserName}" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="mb-3">
                                <label for="rol" class="form-label">Roll</label>
                                <select class="form-select" aria-label="Default select example" th:field="*{Roll.IdRoll}">
                                    <option selected value=0>Selecciona un roll</option>
                                    <option th:each="roll : ${rolles}" th:value="${roll.IdRoll}" th:text="${roll.NombreRoll}"></option>
                                </select>
                                <span th:if="${#fields.hasErrors('Roll.IdRoll')}" th:errors="*{Roll.IdRoll}" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="mb-3">
                                <label for="curp" class="form-label">Curp</label>
                                <input type="text" class="form-control" id="username" name="Curp" th:field="*{Curp}">
                                <span th:if="${#fields.hasErrors('Curp')}"  th:errors="*{Curp}" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row my-1">
                        <div class="col-6">
                            <div class="mb-3">
                                <label for="fecha" class="form-label">Fecha de Nacimiento</label>
                                <input type="date" class="form-control" id="fecha" th:field="*{FechaNacimiento}" > <!-- onblur="isCorrectDate(event, this)" -->
                                <span th:if="${#fields.hasErrors('FechaNacimiento')}"  th:errors="*{FechaNacimiento}" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="col-6">
                            <div class="mb-3">
                                <label for="nombre" class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="NombreUsuario" th:field="*{Nombre}"> <!-- onblur="isSoloLetras(event, this)"-->
                                <span th:if="${#fields.hasErrors('Nombre')}" th:errors="*{Nombre}" class="text-danger"></span>
                            </div>

                        </div>

                    </div>
                    <div class="row my-1">
                        <div class="col-6">
                            <div class="mb-3">
                                <label for="apellidoPaterno" class="form-label">Apellido Paterno</label>
                                <input type="text" class="form-control" id="apellidoPaterno" th:field="*{ApellidoPaterno}"> <!-- onblur="isWorld(event, this)" -->
                                <span th:if="${#fields.hasErrors('ApellidoPaterno')}" th:errors="*{ApellidoPaterno}" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="mb-3">
                                <label for="apellidoMaterno" class="form-label">Apellido Materno</label>
                                <input type="text" class="form-control" id="nombre" th:field="*{ApellidoMaterno}" ><!-- onblur="isWorld(event, this)"-->
                                <span th:if="${#fields.hasErrors('ApellidoMaterno')}" th:errors="*{ApellidoMaterno}" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row my-1">
                        <div class="col-4">
                            <div class="mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" th:field="*{Email}" ><!-- onblur="isEmail(event, this)" -->
                                <span th:if="${#fields.hasErrors('Email')}" th:errors="*{Email}" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="mb-3">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="password" th:field="*{Password}">   <!-- onblur="isPassword(event, this)" -->
                                <span th:if="${#fields.hasErrors('Password')}" th:errors="*{Password}" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="mb-3">
                                <div class="form-label"> Genero</div>
                                <div class="row">
                                    <div class="col-6">
                                        <input class="form-check-input" type="radio" name="radioDefault" id="radioDefault1" value="F" th:field="*{Sexo}">
                                        <label class="form-check-label" for="radioDefault1">Femenino </label>
                                    </div> 
                                    <div class="col-6">
                                        <input class="form-check-input" type="radio" name="radioDefault" id="radioDefault2" checked value="M" th:field="*{Sexo}">
                                        <label class="form-check-label" for="radioDefault2">
                                            Masculino
                                        </label>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="h6 text-black-50"> Datos de Contacto</div>
                    <div class="row my-1">
                        <div class="col-6">
                            <div class="mb-3">
                                <label for="telefono" class="form-label">Telefono</label>
                                <input type="text" class="form-control" id="telefono" th:field="*{Telefono}" > <!-- onblur="isNumber(event,this)"-->
                                <span th:if="${#fields.hasErrors('Telefono')}" th:errors="*{Telefono}" class="text-danger"></span>

                            </div>
                        </div>
                        <div class="col-6">
                            <div class="mb-3">
                                <label for="celular" class="form-label">Celular</label>
                                <input type="text" class="form-control" id="celular" th:field="*{Celular}"> <!-- onblur="isNumber(event, this)" -->
                                <span th:if="${#fields.hasErrors('Celular')}" th:errors="*{Celular}" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-6 h6 text-black-50">
                            Direcciones
                        </div>
                        <div class="col-6 d-flex justify-content-end">
                            <button class="btn btn-outline-dark">
                                <i class="bi bi-plus">Agregar otra direccion</i>
                            </button>
                        </div>
                    </div>
                    <div class="card p-3">
                        <div class="row my-1">
                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="pais" class="form-label">Pais</label>
                                    <select id="ddlpais" class="form-select" aria-label="Default select example">
                                        <option selected value=0> Ingrese un Pais</option>
                                        <option th:each="pais : ${paises}" th:value="${pais.IdPais}" th:text="${pais.Nombre}"></option>

                                    </select>
                                </div>
                            </div>
                            <div class="col-4">
                                <label for="estado" class="form-label">Estado</label>
                                <select id="ddlestado" class="form-select" aria-label="Default select example" >
                                    <option value=0 selected>Selecciona un estado</option>
                                </select>
                            </div>
                            <div class="col-4">
                                <label for="municipio" class="form-label">Municipio</label>
                                <select id="ddlmunicipio" class="form-select" aria-label="Default select example">
                                    <option value=0 selected>Selecciona un municipio</option>
                                </select>
                            </div>
                        </div>
                        <div class="row my-1">
                            <div class="col-4">
                                <label for="colonia" class="form-label">Colonia</label>
                                <select id="ddlcolonia" class="form-select" aria-label="Default select example" th:field = "*{Direccion[0].Colonia.IdColonia}">
                                    <option value=0 selected>Selecciona una colonia</option>
                                </select>
                            </div>
                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="codigoPostal" class="form-label">Codigo Postal</label>
                                    <input type="text" class="form-control" id="codigoPostal" th:field="*{Direccion[0].Calle}">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="mb-3">
                                    <label for="calle" class="form-label">Calle</label>
                                    <input type="text" class="form-control" id="calle" th:field="*{Direccion[0].Calle}">
                                </div>
                            </div>
                        </div>
                        <div class="row my-1">
                            <div class="col-6">
                                <label for="numeroInterior" class="form-label">Numero Interior</label>
                                <input type="number" class="form-control" id="numeroInterior" th:field = "*{Direccion[0].NumeroInterior}">
                            </div>
                            <div class="col-6">
                                <label for="numeroExterior" class="form-label">Numero Exterior</label>
                                <input type="number" class="form-control" id="numeroExterior" th:field = "*{Direccion[0].NumeroExterior}">
                            </div>
                        </div>
                    </div>
                    <div class="py-3 h6 text-black-50"> Foto</div>
                    <div  class="d-grid gap-2">
                         <input type="file" class="form-control mb-2" name="imagenFile" id="imagenFile" accept="image/*">
                    </div>
                    <div class="row my-1 py-3 ">
                        <div class="col-6 d-grid gap-2">
                            <a class="btn btn-danger" th:href="@{/usuario}"> Cancelar </a>
                        </div>
                        <div class="col-6 d-grid gap-2">
                            <button class="btn btn-primary" type="submit">Agregar</button>
                        </div>
                    </div>
                </form>
            </div>  
        </main>
        <footer></footer>
    </body>
    <script type="text/javascript">

        $(document).ready(function () {

            $("#ddlpais").change(function () {
                $.ajax({
                    type: 'GET',
                    url: "/usuario/estado/" + $("#ddlpais").val(),
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {

                        $("#ddlestado").empty();
                        $("#ddlestado").append("<option value=0 selected>Selecciona un estado</option>");
                        $.each(data.objects, function (i, estado) {
                            $("#ddlestado").append("<option value= " + estado.idEstado + "> " + estado.nombre + "</option>");
                        });

                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("no hay nada por cargar :/");
                    }
                });
            });
            
            $("#ddlestado").change(function () {
                $.ajax({
                    type: 'GET',
                    url: "/usuario/municipio/" + $("#ddlestado").val(),
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {

                        $("#ddlmunicipio").empty();
                        $("#ddlmunicipio").append("<option value = 0 selected> Selecciona un municipio</option>");
                        $.each(data.objects, function (i, municipio) {
                            $("#ddlmunicipio").append("<option value= " + municipio.idMunicipio + "> " + municipio.nombre + "</option>");
                        });
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("no hay nada por cargar :/");
                    }
                });
            });
            
            $("#ddlmunicipio").change(function () {
                $.ajax({
                    type: 'GET',
                    url: "/usuario/colonia/" + $("#ddlmunicipio").val(),
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {

                        $("#ddlcolonia").empty();
                        $("#ddlcolonia").append("<option value = 0 selected> Selecciona una colonia</option>");
                        $.each(data.objects, function (i, colonia) {
                            $("#ddlcolonia").append("<option value= " + colonia.idColonia + " data-cp=" + colonia.codigoPostal+" >" + colonia.nombre + "</option>");
                            //alert(colonia.codigoPostal);
                        });
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("no hay nada por cargar :/");
                    }
                });
            });
            
            $("#ddlcolonia").change(function () {
                
                $("#codigoPostal").empty();
                $("#codigoPostal").val($("#ddlcolonia option:selected").data("cp") ) ;
            });
        });

//        function isSoloLetras(event, input) {
//
//            let value = $(input).val();
//
//            let RegExp = /^[a-zA-ZnÑ]+[\s]?[a-zA-ZnÑ]*?$/;
//            if (RegExp.test(value)) {
//
//                $(input).removeClass("error").addClass("correct");
//                $(input).siblings(".error-msg").text("");
//
//            } else {
//
//                $(input).removeClass("correct").addClass("error");
//                $(input).siblings(".error-msg").text("El texto solo permite letras");
//                event.preventDefault();
//            }
//        }

//        function isWorld(event, input) {
//
//            let value = $(input).val();
//            let RegExp = /^[^\s][a-zA-ZñÑ]+$/;
//            if (RegExp.test(value)) {
//
//                $(input).removeClass("error").addClass("correct");
//                $(input).siblings(".error-msg").text("");
//
//
//            } else {
//
//                $(input).removeClass("correct").addClass("error");
//                $(input).siblings(".error-msg").text("El texto solo permite letras");
//                event.preventDefault();
//            }
//
//        }

//        function isUserName(event, input) {
//
//            let value = $(input).val();
//
//            let RegExp = /^(?=(?:.*\d){2})(?=(?:.*[A-Z]){1})(?=(?:.*[a-z]){2})\S{8,}$/;
//            if (RegExp.test(value)) {
//
//                $(input).removeClass("error").addClass("correct");
//                $(input).siblings(".error-msg").text("");
//
//            } else {
//
//                $(input).removeClass("correct").addClass("error");
//                $(input).siblings(".error-msg").text("El username solo permite letras, numeros y guiones");
//                event.preventDefault();
//            }
//
//        }
        
//        function isEmail(event, input) {
//
//            let value = $(input).val();
//            let RegExp = /(^[^\s]+@+[a-zA-Z0-9_-]+[\.]+[a-zA-Z0-9_-]+[\.]+[a-zA-Z0-9_-]+$)/;
//            if (RegExp.test(value)) {
//
//                $(input).removeClass("error").addClass("correct");
//                $(input).siblings(".error-msg").text("");
//
//            } else {
//
//                $(input).removeClass("correct").addClass("error");
//                $(input).siblings(".error-msg").text("El correo es incorrecto");
//                event.preventDefault();
//            }
//
//        }
        
//        function isPassword(event, input) {
//
//            let value = $(input).val();
//            let RegExp = /(?=.{8})(?=.*[A-Z])(?=.*[-_])^[a-zA-ZñÑ0-9_-]+$/;
//            if (RegExp.test(value)) {
//
//                $(input).removeClass("error").addClass("correct");
//                $(input).siblings(".error-msg").text("");
//
//            } else {
//                $(input).removeClass("correct").addClass("error");
//                $(input).siblings(".error-msg").text("El password debe tener al menos 8 caracteres con una mayuscula, un numero y una letra");
//                event.preventDefault();
//            }
//
//        }
        
//        function isNumber(event, input) {
//
//            let value = $(input).val();
//            let RegExp = /+*([0-9]{2,3})*\s*[0-9]{10}/;
//            if (RegExp.test(value)) {
//
//                $(input).removeClass("error").addClass("correct");
//                $(input).siblings(".error-msg").text("");
//
//            } else {
//                $(input).removeClass("correct").addClass("error");
//                $(input).siblings(".error-msg").text("Solo se permiten numeros");
//                event.preventDefault();
//            }
//        }
        
//        function isCorrectDate(event, input) {
//
//            let value = $(input).val();
//            let fecha = new Date();
//            let fechaHoy = fecha.toLocaleDateString();
//            alert();
//            if (value < fecha) {
//                $(input).removeClass("error").addClass("correct");
//                $(input).siblings(".error-msg").text("");
//            } else {
//                $(input).removeClass("correct").addClass("error");
//                $(input).siblings(".error-msg").text("La fecha debe ser menor a hoy");
//                event.preventDefault();
//            }
//
//        }

    </script>
</html>
